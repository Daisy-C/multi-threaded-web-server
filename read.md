## 多线程

首先创建一个主线程，主线程新建一个 socket 用于监听发来的请求。

用 accpet 方法阻塞监听连接，当主线程接受到一个新的请求的时候，accpet 方法会生成
一个新的套接字用于处理这个 tcp 连接的数据传输。

把这个新生成的套接字放入任务队列中，线程池中的线程从任务队列中拿出套接字进行数据传输。

对于每一个线程，采用 python 队列的 get 方法进行阻塞，当任务队列中有任务的时候，
得到套接字运行线程。

## 线程池管理

当一段时间内请求过多的时候，需要释放最开始正在执行的线程所占用的资源，处理新的请求。

每隔一段时间运行监控过程，如果此时工作线程池已满并且任务队列中有尚未处理的任务的时候，取出运行线程队列的队首线程，释放该线程所占用的资源，然后让该线程处理新的任务。

## HTTP 请求

当线程处理一个 http 任务的时候，首先需要解析 http 的包头信息。其中包含了请求类型、编码、客户端、时间等信息。

我们只需要解析处请求类型的信息。请求类型在包头的第一行，用 "/" 分隔，解析其中的请求类型和请求的资源，进行接下来的步骤。

### get 请求

首先判断请求的资源是否存在，如果不存在，发送404错误码和404页面。

如果存在，发送 200 OK的信息和文件类型信息，然后读取请求的资源发送给客户端。

### HEAD请求

在 get 请求的实现中加入判断，如果带有 head 标记，就不读取文件内容，返回结果。

### post 请求

对于 post 请求，需要将参数传入 cgi 程序，这里采用 python 的 subprocess 库建立一个新的进程运行 cgi 程序，获取程序运行的结果后发送给客户端。

### cgi

#### 计算器

采用 python 实现计算器功能，读取传入的参数，相加后修改模板文件，将生成的页面代码返回给 post 线程。